<template>
  <UModal
    :open="open"
    fullscreen
    class="m-4 overflow-y-scroll"
    @update:open="(val) => $emit('update:open', val)"
  >
    <template #content>
      <UCard
        :ui="{
          header:
            'bg-gradient-to-r from-blue-600 via-purple-600 to-blue-700 text-white font-bold shadow-lg',
          body: 'p-0',
        }"
        class="rounded-2xl shadow-2xl border-0 overflow-hidden"
      >
        <template #header>
          <div class="flex justify-between items-center p-1.5">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm"
              >
                <UIcon name="i-heroicons-sparkles" class="w-5 h-5 text-white" />
              </div>
              <div>
                <h2 class="text-xl font-bold">AIË¶ãÁ©ç„ÇÇ„Çä„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</h2>
                <p class="text-white/80 text-sm">
                  Âõ≥Èù¢ÂàÜÊûê„ÇíÂü∫„Å´„Åó„ÅüË¶ãÁ©ç„ÇÇ„Çä‰ΩúÊàê
                </p>
              </div>
            </div>
            <div class="flex gap-3 items-center">
              <!-- „Çª„ÉÉ„Ç∑„Éß„É≥IDË°®Á§∫ -->
              <div
                v-if="
                  blueprintEstimateCreateProcessController.selectedEstimateProcessSessionId
                "
                class="hidden md:flex items-center gap-2 bg-white/10 backdrop-blur-sm rounded-full px-3 py-1"
              >
                <UIcon
                  name="i-heroicons-signal"
                  class="w-3 h-3 text-green-300"
                />
                <span class="text-xs text-white/90 font-mono">
                  „Çª„ÉÉ„Ç∑„Éß„É≥:{{ googleAiAgent.currentSessionId }}
                </span>
              </div>
              <UButton
                color="neutral"
                variant="ghost"
                size="lg"
                icon="i-heroicons-x-mark"
                class="rounded-full hover:bg-white/10 transition-all duration-200 text-white hover:text-gray-200"
                @click="emit('update:open', false)"
              />
            </div>
          </div>
        </template>

        <div
          class="bg-gradient-to-br from-gray-50 to-blue-50/30 flex overflow-y-scroll relative"
        >
          <!-- Â∑¶ÂÅ¥: „Çπ„ÉÜ„ÉÉ„Éó„Ç´„Éº„Éâ -->
          <div
            class="w-80 min-w-80 bg-white/80 backdrop-blur-sm border-r border-gray-200 p-4 flex-shrink-0 relative"
          >
            <!-- ÈÄ≤Êçó„Çµ„Éû„É™„Éº -->
            <div
              class="mb-4 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-100"
            >
              <div class="flex items-center gap-2 mb-2">
                <UIcon
                  name="i-heroicons-chart-pie"
                  class="w-4 h-4 text-blue-600"
                />
                <span class="text-sm font-medium text-blue-800">ÂÖ®‰ΩìÈÄ≤Êçó</span>
                <span class="text-xs text-gray-600 ml-auto"
                  >{{ completedStepsCount }}/{{ estimateSteps.length }}</span
                >
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2 mb-1">
                <div
                  class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-500"
                  :style="{ width: `${progressPercentage}%` }"
                />
              </div>
              <div class="text-xs text-gray-600 text-center">
                {{ progressPercentage }}% ÂÆå‰∫Ü
              </div>
            </div>

            <div class="mb-3">
              <h3 class="text-lg font-bold text-gray-800">
                Ë¶ãÁ©ç„ÇÇ„Çä‰ΩúÊàê„Çπ„ÉÜ„ÉÉ„Éó
              </h3>
            </div>

            <!-- „Çπ„ÉÜ„ÉÉ„Éó„Ç´„Éº„Éâ‰∏ÄË¶ß -->
            <div class="space-y-2 pb-32">
              <div
                v-for="(step, index) in estimateSteps"
                :key="step.id"
                class="relative"
              >
                <!-- „Çπ„ÉÜ„ÉÉ„Éó„Ç´„Éº„Éâ -->
                <div
                  class="rounded-lg p-3 border-2 transition-all duration-300 cursor-pointer hover:shadow-md"
                  :class="[
                    step.status === 'completed'
                      ? 'bg-green-50 border-green-200 hover:border-green-300'
                      : step.status === 'in-progress'
                      ? 'bg-blue-50 border-blue-200 hover:border-blue-300'
                      : 'bg-gray-50 border-gray-200 hover:border-gray-300',
                  ]"
                  @click="selectStep(step)"
                >
                  <!-- „Çπ„ÉÜ„ÉÉ„Éó„Éò„ÉÉ„ÉÄ„Éº -->
                  <div class="flex items-center gap-3">
                    <!-- „Çπ„ÉÜ„ÉÉ„ÉóÁï™Âè∑ -->
                    <div
                      class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0"
                      :class="[
                        step.status === 'completed'
                          ? 'bg-green-500 text-white'
                          : step.status === 'in-progress'
                          ? 'bg-blue-500 text-white'
                          : 'bg-gray-300 text-gray-600',
                      ]"
                    >
                      <UIcon
                        v-if="step.status === 'completed'"
                        name="i-heroicons-check"
                        class="w-3 h-3"
                      />
                      <UIcon
                        v-else-if="step.status === 'in-progress'"
                        name="i-heroicons-arrow-path"
                        class="w-3 h-3 animate-spin"
                      />
                      <span v-else class="text-xs">{{ index + 1 }}</span>
                    </div>

                    <!-- „Çπ„ÉÜ„ÉÉ„Éó„Çø„Ç§„Éà„É´ -->
                    <div class="flex-1 min-w-0">
                      <h4 class="font-semibold text-gray-800 text-sm truncate">
                        {{ step.title }}
                      </h4>
                      <!-- ÈÄ≤ÊçóË©≥Á¥∞ -->
                      <div
                        v-if="step.details"
                        class="text-xs text-gray-500 mt-1 truncate"
                      >
                        {{ step.details }}
                      </div>
                    </div>

                    <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏ -->
                    <UBadge
                      :color="getBadgeColor(step.status)"
                      variant="soft"
                      size="xs"
                      class="flex-shrink-0"
                    >
                      {{ getStatusText(step.status) }}
                    </UBadge>
                  </div>
                </div>

                <!-- Êé•Á∂öÁ∑ö -->
                <div
                  v-if="index < estimateSteps.length - 1"
                  class="absolute left-6 top-full w-0.5 h-2 bg-gray-300 transform -translate-x-1/2"
                />
              </div>
            </div>

            <!-- „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç®„É™„Ç¢ÔºàÂ∑¶‰∏ãÂõ∫ÂÆöÔºâ -->
            <div
              v-if="
                blueprintEstimateCreateProcessController.pdfFileIsDownloaded
              "
              class="absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-gray-200 p-4"
            >
              <div class="space-y-3">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-sm font-medium text-gray-700">
                    üìÅ„Éâ„Ç≠„É•„É°„É≥„Éà„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                  </span>
                </div>

                <!-- step4ÂÆå‰∫ÜÂâç„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº -->
                <div
                  v-if="
                    !blueprintEstimateCreateProcessController.isStep5Completed
                  "
                  class="space-y-2"
                >
                  <div
                    class="flex items-center justify-between p-2 bg-gray-50 rounded-lg border border-gray-200"
                  >
                    <div class="flex items-center gap-2">
                      <UIcon
                        name="i-heroicons-document-text"
                        class="w-4 h-4 text-gray-400"
                      />
                      <span class="text-xs text-gray-500">Ë¶ãÁ©çÊõ∏PDF</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <div
                        class="w-2 h-2 bg-gray-300 rounded-full animate-pulse"
                      />
                      <span class="text-xs text-gray-400">ÁîüÊàê‰∏≠...</span>
                    </div>
                  </div>
                  <div
                    class="flex items-center justify-between p-2 bg-gray-50 rounded-lg border border-gray-200"
                  >
                    <div class="flex items-center gap-2">
                      <UIcon
                        name="i-heroicons-clipboard-document-list"
                        class="w-4 h-4 text-gray-400"
                      />
                      <span class="text-xs text-gray-500">ÊòéÁ¥∞Êõ∏PDF</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <div
                        class="w-2 h-2 bg-gray-300 rounded-full animate-pulse"
                      />
                      <span class="text-xs text-gray-400">ÁîüÊàê‰∏≠...</span>
                    </div>
                  </div>
                </div>

                <!-- step5ÂÆå‰∫ÜÂæå„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥ -->
                <div v-else class="space-y-2">
                  <!-- „Éï„Ç°„Ç§„É´Ê∫ñÂÇô‰∏≠„ÅÆË°®Á§∫ -->
                  <div
                    v-if="
                      !blueprintEstimateCreateProcessController.areOutputFilesReady &&
                      blueprintEstimateCreateProcessController.isDownloadingOutputFiles
                    "
                    class="text-center py-2"
                  >
                    <div class="flex items-center gap-2 justify-center">
                      <UIcon
                        name="i-heroicons-arrow-path"
                        class="w-4 h-4 text-blue-500 animate-spin"
                      />
                      <span class="text-xs text-gray-600"
                        >„Éï„Ç°„Ç§„É´Ê∫ñÂÇô‰∏≠...</span
                      >
                    </div>
                  </div>

                  <!-- „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥ -->
                  <template
                    v-else-if="
                      blueprintEstimateCreateProcessController.areOutputFilesReady
                    "
                  >
                    <!-- Ë¶ãÁ©çÊõ∏„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥ -->
                    <UButton
                      v-if="
                        blueprintEstimateCreateProcessController.isEstimationFileReady
                      "
                      color="error"
                      variant="soft"
                      size="sm"
                      class="w-full justify-start"
                      @click="
                        blueprintEstimateCreateProcessController.downloadEstimationFile()
                      "
                    >
                      <template #leading>
                        <UIcon
                          name="i-heroicons-document-text"
                          class="w-4 h-4"
                        />
                      </template>
                      <span class="text-xs">Ë¶ãÁ©çÊõ∏„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</span>
                      <template #trailing>
                        <UIcon
                          name="i-heroicons-arrow-down-tray"
                          class="w-3 h-3"
                        />
                      </template>
                    </UButton>

                    <!-- ÊòéÁ¥∞Êõ∏„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥ -->
                    <UButton
                      v-if="
                        blueprintEstimateCreateProcessController.isPartsBreakdownFileReady
                      "
                      color="error"
                      variant="soft"
                      size="sm"
                      class="w-full justify-start"
                      @click="
                        blueprintEstimateCreateProcessController.downloadPartsBreakdownFile()
                      "
                    >
                      <template #leading>
                        <UIcon
                          name="i-heroicons-clipboard-document-list"
                          class="w-4 h-4"
                        />
                      </template>
                      <span class="text-xs">ÊòéÁ¥∞Êõ∏„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</span>
                      <template #trailing>
                        <UIcon
                          name="i-heroicons-arrow-down-tray"
                          class="w-3 h-3"
                        />
                      </template>
                    </UButton>

                    <!-- „Éï„Ç°„Ç§„É´„ÅåÈÉ®ÂàÜÁöÑ„Å´Ê∫ñÂÇô„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆË°®Á§∫ -->
                    <div
                      v-if="
                        !blueprintEstimateCreateProcessController.isEstimationFileReady ||
                        !blueprintEstimateCreateProcessController.isPartsBreakdownFileReady
                      "
                      class="text-center py-1"
                    >
                      <div class="flex items-center gap-2 justify-center">
                        <UIcon
                          name="i-heroicons-exclamation-triangle"
                          class="w-3 h-3 text-amber-500"
                        />
                        <span class="text-xs text-amber-600">
                          ‰∏ÄÈÉ®„ÅÆ„Éï„Ç°„Ç§„É´„ÅÆÊ∫ñÂÇô‰∏≠„Åß„Åô...
                        </span>
                      </div>
                    </div>
                  </template>

                  <!-- „Éï„Ç°„Ç§„É´Ê∫ñÂÇôÂ§±ÊïóÊôÇ -->
                  <div v-else class="text-center py-2">
                    <div class="flex items-center gap-2 justify-center mb-2">
                      <UIcon
                        name="i-heroicons-exclamation-triangle"
                        class="w-4 h-4 text-red-500"
                      />
                      <span class="text-xs text-red-600"
                        >„Éï„Ç°„Ç§„É´Ê∫ñÂÇô„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</span
                      >
                    </div>
                    <UButton
                      color="neutral"
                      variant="soft"
                      size="xs"
                      @click="
                        blueprintEstimateCreateProcessController.downloadOutputFiles()
                      "
                    >
                      ÂÜçË©¶Ë°å
                    </UButton>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Âè≥ÂÅ¥: „ÉÅ„É£„ÉÉ„ÉàÈÉ®ÂàÜ -->
          <div class="flex-1 flex flex-col">
            <!-- UTabs for „ÉÅ„É£„ÉÉ„Éà/Âõ≥Èù¢/Ëß£ÊûêÁµêÊûú -->
            <UTabs v-model="currentActiveTab" :items="tabItems">
              <!-- „ÉÅ„É£„ÉÉ„Éà„Çø„Éñ -->
              <template #chat>
                <div class="h-[75vh] flex flex-col overflow-hidden">
                  <!-- ‰ºöË©±ÁîªÈù¢ -->
                  <div class="h-full flex flex-col overflow-hidden">
                    <!-- „Çª„ÉÉ„Ç∑„Éß„É≥ÊÉÖÂ†±„Ç®„É™„Ç¢ -->
                    <div
                      class="bg-white/80 backdrop-blur-sm border-b border-blue-100 p-4 flex-shrink-0"
                    >
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                          <div
                            class="w-3 h-3 bg-green-400 rounded-full animate-pulse"
                          />
                          <span class="text-sm font-medium text-gray-700"
                            >Êé•Á∂ö‰∏≠</span
                          >
                          <span
                            class="text-xs text-gray-500 font-mono bg-gray-100 px-2 py-1 rounded-full"
                          >
                            {{ googleAiAgent.currentSessionId.slice(-12) }}
                          </span>
                        </div>

                        <!-- ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„ÉóË°®Á§∫„Ç®„É™„Ç¢Ôºà‰∏≠Â§ÆÔºâ -->
                        <div class="flex-1 flex justify-center">
                          <div
                            class="flex items-center gap-2 md:gap-3 bg-gradient-to-r from-blue-50 to-purple-50 px-3 md:px-4 py-2 rounded-full border border-blue-200 shadow-sm hover:shadow-md transition-shadow duration-200"
                          >
                            <!-- „Çπ„ÉÜ„ÉÉ„Éó„Ç¢„Ç§„Ç≥„É≥ -->
                            <div
                              class="w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0"
                              :class="[
                                updateStepsBasedOnCurrentStep >
                                estimateSteps.length
                                  ? 'bg-green-500 text-white shadow-md'
                                  : updateStepsBasedOnCurrentStep > 0
                                  ? 'bg-blue-500 text-white shadow-md'
                                  : 'bg-gray-400 text-white shadow-md',
                              ]"
                            >
                              <UIcon
                                v-if="
                                  updateStepsBasedOnCurrentStep >
                                  estimateSteps.length
                                "
                                name="i-heroicons-check-circle"
                                class="w-3 h-3 md:w-4 md:h-4"
                              />
                              <UIcon
                                v-else-if="updateStepsBasedOnCurrentStep > 0"
                                name="i-heroicons-arrow-path"
                                class="w-3 h-3 md:w-4 md:h-4 animate-spin"
                              />
                              <UIcon
                                v-else
                                name="i-heroicons-play"
                                class="w-3 h-3 md:w-4 md:h-4"
                              />
                            </div>

                            <!-- „Çπ„ÉÜ„ÉÉ„ÉóÊÉÖÂ†± -->
                            <div class="text-center min-w-0 flex-1">
                              <div
                                class="text-xs md:text-sm font-bold text-gray-800"
                              >
                                {{
                                  updateStepsBasedOnCurrentStep > 0
                                    ? `STEP ${updateStepsBasedOnCurrentStep}`
                                    : "ÈñãÂßãÂâç"
                                }}
                              </div>
                              <div
                                class="text-xs text-gray-600 truncate max-w-32 md:max-w-48"
                              >
                                {{
                                  updateStepsBasedOnCurrentStep > 0 &&
                                  updateStepsBasedOnCurrentStep <=
                                    estimateSteps.length
                                    ? estimateSteps[
                                        updateStepsBasedOnCurrentStep - 1
                                      ]?.title
                                    : updateStepsBasedOnCurrentStep >
                                      estimateSteps.length
                                    ? "ÂÖ®„Çπ„ÉÜ„ÉÉ„ÉóÂÆå‰∫Ü"
                                    : "Âá¶ÁêÜÈñãÂßã„ÇíÂæÖÊ©ü‰∏≠"
                                }}
                              </div>
                            </div>

                            <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏Ôºà„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„ÅÆ„ÅøË°®Á§∫Ôºâ -->
                            <UBadge
                              :color="
                                updateStepsBasedOnCurrentStep >
                                estimateSteps.length
                                  ? 'success'
                                  : updateStepsBasedOnCurrentStep > 0
                                  ? 'primary'
                                  : 'neutral'
                              "
                              variant="soft"
                              size="xs"
                              class="hidden md:inline-flex flex-shrink-0"
                            >
                              {{
                                updateStepsBasedOnCurrentStep >
                                estimateSteps.length
                                  ? "ÂÆå‰∫Ü"
                                  : updateStepsBasedOnCurrentStep > 0
                                  ? "ÈÄ≤Ë°å‰∏≠"
                                  : "ÂæÖÊ©ü‰∏≠"
                              }}
                            </UBadge>
                          </div>
                        </div>

                        <div class="text-xs text-gray-500">
                          {{ googleAiAgent.conversationHistory.length }}
                          „É°„ÉÉ„Çª„Éº„Ç∏
                        </div>
                      </div>
                    </div>

                    <!-- ‰ºöË©±Â±•Ê≠¥„Ç®„É™„Ç¢ -->
                    <div
                      ref="conversationArea"
                      class="flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-transparent to-blue-50/20"
                    >
                      <!-- ‰ºöË©±„É°„ÉÉ„Çª„Éº„Ç∏ -->
                      <template
                        v-for="(
                          message, index
                        ) in googleAiAgent.conversationHistoryForView"
                        :key="message.id"
                      >
                        <div
                          v-if="message.type === 'text'"
                          class="flex animate-fade-in"
                          :class="
                            message.role === 'user'
                              ? 'justify-end'
                              : 'justify-start'
                          "
                          :style="{ animationDelay: `${index * 0.1}s` }"
                        >
                          <div
                            class="max-w-[calc(100%-2rem)] md:max-w-[70%] group"
                            :class="
                              message.role === 'user'
                                ? 'flex flex-col items-end'
                                : 'flex flex-col items-start'
                            "
                          >
                            <!-- „É°„ÉÉ„Çª„Éº„Ç∏„Éê„Éñ„É´ -->
                            <div
                              class="rounded-3xl px-5 py-3 shadow-md transform transition-all duration-200 hover:scale-[1.02] hover:shadow-lg"
                              :class="[
                                message.role === 'user'
                                  ? 'bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-br-lg'
                                  : 'bg-white border border-gray-100 text-gray-800 rounded-bl-lg',
                              ]"
                            >
                              <!-- ÈÄöÂ∏∏„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ -->
                              <div
                                class="whitespace-pre-wrap leading-relaxed break-words word-break overflow-wrap-anywhere github-markdown"
                                v-html="convertMarkdownToHtml(message.content)"
                              />
                            </div>

                            <!-- „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Å®„Çπ„ÉÜ„Éº„Çø„Çπ -->
                            <div
                              class="flex items-center gap-1 mt-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                              :class="
                                message.role === 'user'
                                  ? 'flex-row-reverse'
                                  : 'flex-row'
                              "
                            >
                              <span class="text-xs text-gray-500">
                                {{ formatTime(message.timestamp) }}
                              </span>
                              <UIcon
                                v-if="message.role === 'user'"
                                name="i-heroicons-check-circle"
                                class="w-3 h-3 text-blue-500"
                              />
                            </div>
                          </div>
                        </div>
                      </template>

                      <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫ -->
                      <div
                        v-if="googleAiAgent.isProcessing"
                        class="flex justify-start animate-fade-in"
                      >
                        <div class="flex flex-col items-start">
                          <div
                            class="bg-white border border-gray-100 rounded-3xl rounded-bl-lg px-5 py-3 shadow-md"
                          >
                            <div class="flex items-center gap-3">
                              <div class="flex gap-1">
                                <div
                                  class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
                                  style="animation-delay: 0ms"
                                />
                                <div
                                  class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
                                  style="animation-delay: 150ms"
                                />
                                <div
                                  class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"
                                  style="animation-delay: 300ms"
                                />
                              </div>
                              <span class="text-gray-600 text-sm"
                                >AI„Ç®„Éº„Ç∏„Çß„É≥„Éà„ÅåÊ•≠Âãô„ÇíÂÆüË°å‰∏≠...</span
                              >
                            </div>
                          </div>
                          <div class="text-xs text-gray-500 mt-1 px-2">
                            {{ formatTime(new Date()) }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- „É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•Âäõ„Ç®„É™„Ç¢ -->
                    <div
                      class="bg-white/90 backdrop-blur-sm border-t border-gray-100 p-4 flex-shrink-0"
                    >
                      <div class="flex gap-3 items-center justify-center">
                        <UInput
                          v-model="userInput"
                          placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."
                          size="xl"
                          class="focus:border-blue-400 focus:ring-blue-400 transition-all duration-200 w-2/3"
                          :ui="{
                            base: 'rounded-2xl  focus:border-blue-400 transition-all duration-200',
                          }"
                          :disabled="googleAiAgent.isProcessing"
                          @keydown.enter.prevent="handleEnterKey"
                        />
                        <UButton
                          color="primary"
                          variant="solid"
                          size="lg"
                          class="rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl"
                          :disabled="
                            !userInput.trim() || googleAiAgent.isProcessing
                          "
                          :loading="googleAiAgent.isProcessing"
                          @click="sendMessage"
                        >
                          <div class="flex items-center gap-1">
                            <UIcon
                              name="i-heroicons-paper-airplane"
                              class="w-5 h-5 transform rotate-45"
                            />
                            <div>ÈÄÅ‰ø°</div>
                          </div>
                        </UButton>
                        <div class="text-xs text-gray-500">
                          <UIcon
                            name="i-heroicons-command-line"
                            class="w-3 h-3 inline mr-1"
                          />
                          Ctrl+Enter„ÅßÈÄÅ‰ø°
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Âõ≥Èù¢„Çø„Éñ -->
              <template #blueprint>
                <div class="h-[75vh] overflow-y-auto p-4">
                  <BlueprintPreview :preview-url="blueprint.pdfPreviewUrl" />
                </div>
              </template>

              <!-- Ëß£ÊûêÁµêÊûú„Çø„Éñ -->
              <template #analysis>
                <div class="h-[75vh] overflow-y-auto p-4">
                  <BlueprintFormInput
                    :blueprint="blueprint.selectedBlueprint"
                    :disabled="true"
                  />
                </div>
              </template>

              <!-- „Ç¢„Ç¶„Éà„Éó„ÉÉ„Éà„Çø„Éñ -->
              <template #output>
                <div class="h-[75vh] overflow-y-auto p-4">
                  <div class="space-y-6">
                    <!-- „Çπ„ÉÜ„ÉÉ„ÉóÈÅ∏Êäû„Ç¨„Ç§„Éâ -->
                    <div v-if="!selectedStep" class="text-center py-8">
                      <UIcon
                        name="i-heroicons-cursor-arrow-rays"
                        class="w-12 h-12 text-gray-400 mx-auto mb-4"
                      />
                      <div v-if="updateStepsBasedOnCurrentStep === 0">
                        <p class="text-gray-500 text-lg font-medium mb-2">
                          „Åæ„Å†Âá¶ÁêÜ„ÅåÈñãÂßã„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                        </p>
                        <p class="text-gray-400 text-sm">
                          „ÉÅ„É£„ÉÉ„Éà„Çø„Éñ„ÅßÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </p>
                      </div>
                      <div v-else-if="updateStepsBasedOnCurrentStep === 1">
                        <p class="text-gray-500 text-lg font-medium mb-2">
                          Step1„ÇíÂÆüË°å‰∏≠„Åß„Åô
                        </p>
                        <p class="text-gray-400 text-sm">
                          Step1„ÅåÂÆå‰∫Ü„Åó„Åü„Çâ„ÄÅ„Åù„ÅÆÁµêÊûú„ÅåËá™ÂãïÁöÑ„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô
                        </p>
                      </div>
                      <div v-else>
                        <p class="text-gray-500 text-lg font-medium mb-2">
                          „Çπ„ÉÜ„ÉÉ„Éó„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </p>
                        <p class="text-gray-400 text-sm mb-3">
                          Â∑¶ÂÅ¥„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Ç´„Éº„Éâ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅ„Åù„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÁµêÊûú„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô
                        </p>
                        <UBadge variant="soft" color="primary" size="sm">
                          üí° ÁèæÂú®Step{{
                            updateStepsBasedOnCurrentStep
                          }}„ÇíÂÆüË°å‰∏≠„ÅÆ„Åü„ÇÅ„ÄÅStep{{
                            Math.max(1, updateStepsBasedOnCurrentStep - 1)
                          }}„ÅÆÁµêÊûú„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô
                        </UBadge>
                      </div>
                    </div>

                    <!-- STEP2„ÅÆË£ΩÂìÅ„É™„Çπ„Éà -->
                    <div v-if="selectedStep?.id === 2" class="space-y-4">
                      <Step2EstimateOutputPreview />
                      <div class="text-center">
                        <p class="text-sm text-gray-600 mb-2">
                          üí°
                          Ë£ΩÂìÅ„ÅÆÊï∞Èáè„ÇíÁ∑®ÈõÜ„Åó„Å¶„ÄåÊõ¥Êñ∞‰øùÂ≠ò„Äç„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„ÄÅË¶ãÁ©ç„ÇÇ„Çä„Éá„Éº„Çø„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åô
                        </p>
                      </div>
                    </div>

                    <!-- STEP3„ÅÆÈÉ®ÊùêÂàÜËß£„É™„Çπ„Éà -->
                    <div v-if="selectedStep?.id === 3" class="space-y-4">
                      <Step3EstimateOutputPreview />
                      <div class="text-center">
                        <p class="text-sm text-gray-600 mb-2">
                          üí°
                          ÈÉ®ÂìÅ„ÅÆÊï∞Èáè„ÇÑÂçò‰æ°„ÇíÁ∑®ÈõÜ„Åó„Å¶„ÄåÊõ¥Êñ∞‰øùÂ≠ò„Äç„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„ÄÅË¶ãÁ©ç„ÇÇ„Çä„Éá„Éº„Çø„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åô
                        </p>
                      </div>
                    </div>

                    <!-- STEP4„ÅÆË¶ãÁ©çÊõ∏„ÉªÊòéÁ¥∞Êõ∏„Éó„É¨„Éì„É•„Éº -->
                    <div v-if="selectedStep?.id === 4" class="space-y-6">
                      <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                      <div class="text-center">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">
                          üìã Ë¶ãÁ©çÊõ∏„ÉªÊòéÁ¥∞Êõ∏„Éó„É¨„Éì„É•„Éº
                        </h3>
                      </div>

                      <!-- step4Êú™ÂÆå‰∫ÜÊôÇ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏ -->
                      <div
                        v-if="
                          !blueprintEstimateCreateProcessController.isStep5Completed
                        "
                        class="text-center py-12"
                      >
                        <UIcon
                          name="i-heroicons-cog-6-tooth"
                          class="w-16 h-16 text-gray-300 mx-auto mb-4 animate-spin"
                        />
                        <p class="text-lg font-medium text-gray-500 mb-2">
                          Ë¶ãÁ©çÊõ∏„ÇíÁîüÊàê‰∏≠„Åß„Åô...
                        </p>
                        <p class="text-sm text-gray-400">
                          „Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ
                        </p>
                      </div>

                      <!-- step5ÂÆå‰∫ÜÊôÇ„ÅÆ„Çø„ÉñË°®Á§∫ -->
                      <div v-else>
                        <!-- „Éï„Ç°„Ç§„É´Ê∫ñÂÇô‰∏≠„ÅÆË°®Á§∫ -->
                        <div
                          v-if="
                            !blueprintEstimateCreateProcessController.areOutputFilesReady
                          "
                          class="text-center py-12"
                        >
                          <UIcon
                            name="i-heroicons-arrow-path"
                            class="w-16 h-16 text-blue-500 mx-auto mb-4 animate-spin"
                          />
                          <p class="text-lg font-medium text-gray-500 mb-2">
                            „Éï„Ç°„Ç§„É´„ÇíÊ∫ñÂÇô‰∏≠„Åß„Åô...
                          </p>
                          <p class="text-sm text-gray-400">
                            „Éó„É¨„Éì„É•„Éº„ÅÆÊ∫ñÂÇô„Çí„Åó„Å¶„ÅÑ„Åæ„Åô
                          </p>
                        </div>

                        <!-- „Éï„Ç°„Ç§„É´Ê∫ñÂÇôÂÆå‰∫ÜÊôÇ„ÅÆ„Éó„É¨„Éì„É•„Éº -->
                        <UTabs
                          v-else
                          :items="step4PreviewTabs"
                          :default-index="0"
                          class="w-full"
                        >
                          <!-- Ë¶ãÁ©çÊõ∏„Éó„É¨„Éì„É•„Éº -->
                          <template #estimate>
                            <div class="mt-4">
                              <div v-if="estimatePdfUrl" class="h-[60vh]">
                                <iframe
                                  :src="estimatePdfUrl"
                                  class="w-full h-full border border-gray-200 rounded-lg"
                                  title="Ë¶ãÁ©çÊõ∏„Éó„É¨„Éì„É•„Éº"
                                />
                              </div>
                              <div
                                v-else
                                class="h-[60vh] flex items-center justify-center"
                              >
                                <div class="text-center">
                                  <UIcon
                                    name="i-heroicons-exclamation-triangle"
                                    class="w-8 h-8 text-red-500 mx-auto mb-2"
                                  />
                                  <p class="text-red-600">
                                    Ë¶ãÁ©çÊõ∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü
                                  </p>
                                </div>
                              </div>
                            </div>
                          </template>

                          <!-- ÊòéÁ¥∞Êõ∏„Éó„É¨„Éì„É•„Éº -->
                          <template #inner>
                            <div class="mt-4">
                              <div v-if="innerPdfUrl" class="h-[60vh]">
                                <iframe
                                  :src="innerPdfUrl"
                                  class="w-full h-full border border-gray-200 rounded-lg"
                                  title="ÊòéÁ¥∞Êõ∏„Éó„É¨„Éì„É•„Éº"
                                />
                              </div>
                              <div
                                v-else
                                class="h-[60vh] flex items-center justify-center"
                              >
                                <div class="text-center">
                                  <UIcon
                                    name="i-heroicons-exclamation-triangle"
                                    class="w-8 h-8 text-red-500 mx-auto mb-2"
                                  />
                                  <p class="text-red-600">
                                    ÊòéÁ¥∞Êõ∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü
                                  </p>
                                </div>
                              </div>
                            </div>
                          </template>
                        </UTabs>
                      </div>
                    </div>

                    <!-- ‰ªñ„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÁµêÊûúË°®Á§∫„Ç®„É™„Ç¢ÔºàÂ∞ÜÊù•ÁöÑ„Å´ËøΩÂä†Ôºâ -->
                    <div
                      v-if="
                        selectedStep && ![2, 3, 4].includes(selectedStep.id)
                      "
                      class="text-center py-8"
                    >
                      <UIcon
                        name="i-heroicons-cog-6-tooth"
                        class="w-12 h-12 text-gray-400 mx-auto mb-4"
                      />
                      <p class="text-lg font-medium text-gray-500 mb-2">
                        STEP{{ selectedStep.id }}„ÅÆÁµêÊûú
                      </p>
                      <p class="text-sm text-gray-400">
                        „Åì„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÁµêÊûúË°®Á§∫„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô
                      </p>
                    </div>
                  </div>
                </div>
              </template>
            </UTabs>
          </div>
        </div>
      </UCard>
    </template>
  </UModal>
</template>

<script setup lang="ts">
//#region import
import { ref, watch, nextTick, computed } from "vue";
import log from "@utils/logger";
// FirebaseÈñ¢ÈÄ£„ÅÆ„Ç§„É≥„Éù„Éº„Éà„ÅØ„Çπ„Éà„Ç¢ÂÅ¥„ÅßÂá¶ÁêÜ„Åï„Çå„Çã„Åü„ÇÅÂâäÈô§
import { convertMarkdownToHtml } from "@utils/markdown";
//#endregion

//#region types
interface EstimateStep {
  id: number;
  title: string;
  description: string;
  status: "pending" | "in-progress" | "completed";
  details: string;
}

//#endregion

//#region props & emits
const props = defineProps({
  open: Boolean,
  mode: { type: String, default: "blueprintRegister" },
  modelValue: { type: Object, required: true },
  loading: { type: Boolean, default: false },
});
const emit = defineEmits<{
  (e: "update:open", value: boolean): void;
  (e: "register"): void;
}>();
//#endregion

//#region reactive-data
const selectedStep = ref<EstimateStep | null>(null);
const estimatePdfUrl = ref<string | null>(null);
const innerPdfUrl = ref<string | null>(null);
const currentActiveTab = ref("0"); // ÁèæÂú®„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„Éñ„ÇíËøΩË∑°
//#endregion reactive-data

//#region store
const googleAiAgent = useGoogleAiAgentStore();
const blueprintEstimateCreateProcessController =
  useBlueprintEstimateCreateProcessControllerStore();
const blueprint = useBlueprintStore();
const toast = useToast();
//#endregion

//#region ui-config
const userInput = ref("");
const conversationArea = ref<HTMLElement | null>(null);

// „Çø„ÉñË®≠ÂÆö
const tabItems = [
  {
    label: "„ÉÅ„É£„ÉÉ„Éà",
    slot: "chat",
    icon: "i-heroicons-chat-bubble-left-right",
  },
  {
    label: "„Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç",
    slot: "output",
    icon: "i-heroicons-clipboard-document-list",
  },
  {
    label: "Âõ≥Èù¢",
    slot: "blueprint",
    icon: "i-heroicons-document-text",
  },
  {
    label: "Ëß£ÊûêÁµêÊûú",
    slot: "analysis",
    icon: "i-heroicons-chart-bar",
  },
];

// step4„Éó„É¨„Éì„É•„ÉºÁî®„ÅÆ„Çø„ÉñË®≠ÂÆö
const step4PreviewTabs = [
  {
    label: "üìÑ Ë¶ãÁ©çÊõ∏",
    slot: "estimate",
  },
  {
    label: "üìä ÊòéÁ¥∞Êõ∏",
    slot: "inner",
  },
];

// „Çπ„ÉÜ„ÉÉ„ÉóÂÆöÁæ©
const estimateSteps = ref<EstimateStep[]>([
  {
    id: 1,
    title: "Âõ≥Èù¢ÊÉÖÂ†±„ÅÆÂèñÂæó",
    description: "„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüÂõ≥Èù¢„Åã„ÇâÂü∫Êú¨ÊÉÖÂ†±„ÇíÊäΩÂá∫",
    status: "pending",
    details: "",
  },
  {
    id: 2,
    title: "ÂØæË±°Ë£ΩÂìÅ„ÅÆÁâπÂÆö",
    description: "Âõ≥Èù¢„Åã„ÇâË£ΩÈÄ†ÂØæË±°„Å®„Å™„ÇãË£ΩÂìÅ„ÇíÁâπÂÆö",
    status: "pending",
    details: "",
  },
  {
    id: 3,
    title: "ÊòéÁ¥∞„ÅÆÁ¢∫ÂÆö",
    description: "Ë£ΩÂìÅË£ΩÈÄ†„Å´ÂøÖË¶Å„Å™ÈÉ®ÂìÅ„É™„Çπ„Éà„ÇíÁ¢∫ÂÆö",
    status: "pending",
    details: "",
  },
  {
    id: 4,
    title: "Ë¶ãÁ©çÊõ∏„ÅÆÂá∫Âäõ",
    description: "Ë¶ãÁ©çÊõ∏„ÇíÂá∫Âäõ",
    status: "pending",
    details: "",
  },
]);
//#endregion ui-config

//#region computed
// currentStep„Å´Âü∫„Å•„Åè„Çπ„ÉÜ„ÉÉ„ÉóÁä∂ÊÖã„ÅÆÊõ¥Êñ∞
const updateStepsBasedOnCurrentStep = computed(() => {
  const currentStep =
    blueprintEstimateCreateProcessController
      .selectedBlueprintCostEstimationCreateJob?.currentStep || 0;

  // „Çπ„ÉÜ„ÉÉ„Éó„Åî„Å®„ÅÆË©≥Á¥∞„É°„ÉÉ„Çª„Éº„Ç∏ÂÆöÁæ©
  const stepMessages = {
    completed: [
      "Âõ≥Èù¢ÊÉÖÂ†±„ÅÆÂèñÂæó„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
      "ÂØæË±°Ë£ΩÂìÅ„ÅÆÁâπÂÆö„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
      "‰ΩøÁî®ÈÉ®ÂìÅ„ÅÆÊ¥ó„ÅÑÂá∫„Åó„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
      "ÈÉ®ÂìÅÊï∞Èáè/ÈáëÈ°ç„ÅÆÁ¢∫ÂÆö„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
      "Ë¶ãÁ©çÊõ∏‰ΩúÊàê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
    ],
    inProgress: [
      "Âõ≥Èù¢„Åã„ÇâÂü∫Êú¨ÊÉÖÂ†±„ÇíÊäΩÂá∫‰∏≠...",
      "Âõ≥Èù¢„Åã„ÇâË£ΩÈÄ†ÂØæË±°Ë£ΩÂìÅ„ÇíÁâπÂÆö‰∏≠...",
      "Ë£ΩÂìÅË£ΩÈÄ†„Å´ÂøÖË¶Å„Å™ÈÉ®ÂìÅ„ÇíÊ¥ó„ÅÑÂá∫„Åó‰∏≠...",
      "ÂêÑÈÉ®ÂìÅ„ÅÆÂøÖË¶ÅÊï∞Èáè„Å®Âçò‰æ°„ÇíÁÆóÂá∫‰∏≠...",
      "ÊúÄÁµÇÁöÑ„Å™Ë¶ãÁ©çÊõ∏„ÇíÁîüÊàê‰∏≠...",
    ],
  };

  // „Çπ„ÉÜ„ÉÉ„ÉóÁä∂ÊÖã„ÇíÊõ¥Êñ∞
  estimateSteps.value.forEach((step, index) => {
    const stepNumber = index + 1;
    if (stepNumber < currentStep) {
      // ÁèæÂú®„Çπ„ÉÜ„ÉÉ„Éó„Çà„ÇäÂâç„ÅØÂÆå‰∫Ü
      step.status = "completed";
      step.details =
        stepMessages.completed[index] || `„Çπ„ÉÜ„ÉÉ„Éó${stepNumber}„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü`;
    } else if (stepNumber === currentStep) {
      // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅØÈÄ≤Ë°å‰∏≠
      step.status = "in-progress";
      step.details =
        stepMessages.inProgress[index] || `„Çπ„ÉÜ„ÉÉ„Éó${stepNumber}„ÇíÂÆüË°å‰∏≠...`;
    } else {
      // ÁèæÂú®„Çπ„ÉÜ„ÉÉ„Éó„Çà„ÇäÂæå„ÅØÊú™ÈñãÂßã
      step.status = "pending";
      step.details = "";
    }
  });

  return currentStep;
});

// ÂÆå‰∫Ü„Åó„Åü„Çπ„ÉÜ„ÉÉ„ÉóÊï∞ÔºàcurrentStep„Éô„Éº„ÇπÔºâ
const completedStepsCount = computed(() => {
  const currentStep = updateStepsBasedOnCurrentStep.value;
  return Math.max(0, currentStep - 1); // currentStep„Çà„ÇäÂâç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅåÂÆå‰∫ÜÊ∏à„Åø
});

// ÈÄ≤Êçó„Éë„Éº„Çª„É≥„ÉÜ„Éº„Ç∏ÔºàcurrentStep„Éô„Éº„ÇπÔºâ
const progressPercentage = computed(() => {
  const currentStep = updateStepsBasedOnCurrentStep.value;
  const totalSteps = estimateSteps.value.length;

  if (currentStep === 0) return 0;
  if (currentStep > totalSteps) return 100;

  // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Åæ„Åß„ÅÆÈÄ≤Êçó„ÇíË®àÁÆóÔºàÁèæÂú®„Çπ„ÉÜ„ÉÉ„Éó„ÅØ50%„Å®„Åó„Å¶Ë®àÁÆóÔºâ
  const completedProgress = Math.max(0, currentStep - 1) * (100 / totalSteps);
  const currentStepProgress = 0.5 * (100 / totalSteps); // ÁèæÂú®„Çπ„ÉÜ„ÉÉ„Éó„ÅØ50%ÈÄ≤Ë°å„Å®„Åó„Å¶Ë®àÁÆó

  return Math.round(completedProgress + currentStepProgress);
});

// currentStep„Å´Âü∫„Å•„ÅÑ„Å¶Ëá™ÂãïÈÅ∏Êäû„Åô„Åπ„Åç„Çπ„ÉÜ„ÉÉ„Éó„ÇíÊ±∫ÂÆö
const autoSelectedStep = computed(() => {
  const currentStep = updateStepsBasedOnCurrentStep.value;

  // currentStep„Åå0„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇÈÅ∏Êäû„Åó„Å™„ÅÑ
  if (currentStep === 0) return null;

  // currentStep„ÅåÈÄ≤Ë°å‰∏≠„ÅÆÂ†¥Âêà„ÅØ„ÄÅ1„Å§Ââç„ÅÆÂÆå‰∫ÜÊ∏à„Åø„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
  // (ÈÄ≤Ë°å‰∏≠„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅÆ„Ç¢„Ç¶„Éà„Éó„ÉÉ„Éà„ÅØ„Åæ„Å†Â≠òÂú®„Åó„Å™„ÅÑ„Åü„ÇÅ)
  let targetStepId: number;

  if (currentStep === 1) {
    // Step1ÈÄ≤Ë°å‰∏≠„ÅÆÂ†¥Âêà„ÅØË°®Á§∫„Åô„Çã„ÇÇ„ÅÆ„Åå„Å™„ÅÑ
    return null;
  } else if (currentStep <= estimateSteps.value.length) {
    // Step2‰ª•ÈôçÈÄ≤Ë°å‰∏≠„ÅÆÂ†¥Âêà„ÅØ„ÄÅ1„Å§Ââç„ÅÆÂÆå‰∫ÜÊ∏à„Åø„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
    targetStepId = currentStep - 1;
  } else {
    // ÂÖ®„Çπ„ÉÜ„ÉÉ„ÉóÂÆå‰∫Ü„ÅÆÂ†¥Âêà„ÅØ„ÄÅÊúÄÂæå„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó(Step4)„ÇíË°®Á§∫
    targetStepId = estimateSteps.value.length;
  }

  // ÂØæË±°„ÅÆ„Çπ„ÉÜ„ÉÉ„ÉóID„Å´Ë©≤ÂΩì„Åô„Çã„Çπ„ÉÜ„ÉÉ„Éó„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíËøî„Åô
  return estimateSteps.value.find((step) => step.id === targetStepId) || null;
});

//#endregion

//#region methods
// ÂâäÈô§: startEstimateConversation„É°„ÇΩ„ÉÉ„Éâ„ÅØ„Çπ„Éà„Ç¢ÂÅ¥„Å´ÁßªÂãï„Åï„Çå„Åæ„Åó„Åü

// „É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°„Åô„Çã
const sendMessage = async () => {
  if (!userInput.value.trim() || googleAiAgent.isProcessing) return;

  const message = userInput.value.trim();
  userInput.value = "";

  try {
    await googleAiAgent.sendQueryToAgent(message);
    // ‰ºöË©±„Ç®„É™„Ç¢„ÇíÊúÄ‰∏ãÈÉ®„Å´„Çπ„ÇØ„É≠„Éº„É´
    await scrollToBottom();
  } catch (error) {
    log("ERROR", "„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:", error);
    toast.add({
      title: "„Ç®„É©„Éº",
      description: "„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",
      color: "error",
    });
  }
};

// „Çπ„ÉÜ„ÉÉ„Éó„ÇíÈÅ∏Êäû
const selectStep = (step: EstimateStep) => {
  log("INFO", "„Çπ„ÉÜ„ÉÉ„Éó„ÅåÈÅ∏Êäû„Åï„Çå„Åæ„Åó„Åü:", step);
  selectedStep.value = step;
};

// „Çπ„ÉÜ„Éº„Çø„Çπ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó
const getStatusText = (status: string) => {
  switch (status) {
    case "completed":
      return "ÂÆå‰∫Ü";
    case "in-progress":
      return "ÈÄ≤Ë°å‰∏≠";
    case "pending":
    default:
      return "Êú™ÈñãÂßã";
  }
};

// „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Åü„Éê„ÉÉ„Ç∏„Ç´„É©„Éº„ÇíÂèñÂæó
const getBadgeColor = (status: string) => {
  switch (status) {
    case "completed":
      return "success";
    case "in-progress":
      return "primary";
    case "pending":
    default:
      return "neutral";
  }
};

// Enter„Ç≠„Éº„ÅÆÂá¶ÁêÜ
const handleEnterKey = (event: KeyboardEvent) => {
  if (event.ctrlKey || event.metaKey) {
    // Ctrl+Enter „Åæ„Åü„ÅØ Cmd+Enter „ÅßÈÄÅ‰ø°
    sendMessage();
  }
  // ÈÄöÂ∏∏„ÅÆEnter„ÅØÊîπË°åÔºà„Éá„Éï„Ç©„É´„ÉàÂãï‰ΩúÔºâ
};

// ‰ºöË©±„Ç®„É™„Ç¢„ÇíÊúÄ‰∏ãÈÉ®„Å´„Çπ„ÇØ„É≠„Éº„É´
const scrollToBottom = async () => {
  await nextTick();
  if (conversationArea.value) {
    conversationArea.value.scrollTop = conversationArea.value.scrollHeight;
  }
};

// ÊôÇÂàª„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà
const formatTime = (date: Date) => {
  return date.toLocaleTimeString("ja-JP", {
    hour: "2-digit",
    minute: "2-digit",
  });
};

// „Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„Å´ÁßªÂãï„Åó„Åü„Çø„Ç§„Éü„É≥„Ç∞„ÅßcurrentStep„Å´Âü∫„Å•„ÅÑ„Å¶„Çπ„ÉÜ„ÉÉ„Éó„ÇíËá™ÂãïÈÅ∏Êäû
const handleOutputTabActivation = () => {
  log("INFO", "„Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Å™„Çä„Åæ„Åó„Åü");

  // üéØ Êõ∏È°ûÁîüÊàêÂÆå‰∫ÜÊ∏à„Åø„ÅÆÂ†¥Âêà„ÅØstep4„ÇíÂÑ™ÂÖàË°®Á§∫
  const allProcessCompleted =
    blueprintEstimateCreateProcessController
      .selectedBlueprintCostEstimationCreateJob.allProcessCompleted;

  if (allProcessCompleted) {
    const step4 = estimateSteps.value.find((step) => step.id === 4);
    if (step4) {
      selectedStep.value = step4;
      log("INFO", "Êõ∏È°ûÁîüÊàêÂÆå‰∫ÜÊ∏à„Åø„ÅÆ„Åü„ÇÅ„ÄÅStep4„ÇíËá™ÂãïÈÅ∏Êäû„Åó„Åæ„Åó„Åü");
      return;
    }
  }

  // Êõ∏È°ûÁîüÊàêÂÆå‰∫ÜÂâç„ÅØÂæìÊù•„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ„Çí‰ΩøÁî®
  // Ëá™ÂãïÈÅ∏Êäû„Åô„Åπ„Åç„Çπ„ÉÜ„ÉÉ„Éó„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà
  if (autoSelectedStep.value) {
    log(
      "INFO",
      "currentStep„Éô„Éº„Çπ„Åß„Çπ„ÉÜ„ÉÉ„Éó„ÇíËá™ÂãïÈÅ∏Êäû„Åó„Åæ„Åô:",
      autoSelectedStep.value
    );
    selectedStep.value = autoSelectedStep.value;
  } else {
    log(
      "INFO",
      "Ëá™ÂãïÈÅ∏ÊäûÂèØËÉΩ„Å™„Çπ„ÉÜ„ÉÉ„Éó„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàÂá¶ÁêÜÈñãÂßãÂâç„Åæ„Åü„ÅØStep1ÈÄ≤Ë°å‰∏≠Ôºâ"
    );
    selectedStep.value = null;
  }
};

// Âõ≥Èù¢„Éá„Éº„Çø„Å®PDF„Éó„É¨„Éì„É•„ÉºURL„ÇíÂèñÂæó
const loadBlueprintData = async () => {
  if (blueprint.selectedBlueprintId) {
    try {
      await blueprint.fetchBlueprintById({
        blueprintId: blueprint.selectedBlueprintId,
      });
      log("INFO", "Âõ≥Èù¢„Éá„Éº„Çø„Å®PDF„Éó„É¨„Éì„É•„ÉºURL„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü");
    } catch (error) {
      log("ERROR", "Âõ≥Èù¢„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", error);
      toast.add({
        title: "„Ç®„É©„Éº",
        description: "Âõ≥Èù¢„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",
        color: "error",
      });
    }
  }
};

// state„ÅÆBlob„Åã„Çâ„Éó„É¨„Éì„É•„ÉºURL„ÇíÁîüÊàê
const createPdfPreviewUrls = () => {
  // Ë¶ãÁ©çÊõ∏„ÅÆ„Éó„É¨„Éì„É•„ÉºURLÁîüÊàê
  if (blueprintEstimateCreateProcessController.isEstimationFileReady) {
    if (estimatePdfUrl.value) {
      URL.revokeObjectURL(estimatePdfUrl.value);
    }
    estimatePdfUrl.value = URL.createObjectURL(
      blueprintEstimateCreateProcessController.outputEstimationFile!
    );
    log("INFO", "Ë¶ãÁ©çÊõ∏„Éó„É¨„Éì„É•„ÉºURL„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü");
  }

  // ÊòéÁ¥∞Êõ∏„ÅÆ„Éó„É¨„Éì„É•„ÉºURLÁîüÊàê
  if (blueprintEstimateCreateProcessController.isPartsBreakdownFileReady) {
    if (innerPdfUrl.value) {
      URL.revokeObjectURL(innerPdfUrl.value);
    }
    innerPdfUrl.value = URL.createObjectURL(
      blueprintEstimateCreateProcessController.outputPartsBreakdownFile!
    );
    log("INFO", "ÊòéÁ¥∞Êõ∏„Éó„É¨„Éì„É•„ÉºURL„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü");
  }
};

//#endregion methods

// ‰ºöË©±Â±•Ê≠¥„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„ÇâËá™Âãï„Çπ„ÇØ„É≠„Éº„É´
watch(
  () => googleAiAgent.conversationHistoryForView,
  async () => {
    await scrollToBottom();
  },
  { deep: true }
);

// „É¢„Éº„ÉÄ„É´„ÅåÈñâ„Åò„Çâ„Çå„Åü„Å®„Åç„Å´„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
watch(
  () => props.open,
  (open) => {
    if (!open) {
      // „Çπ„Éà„Ç¢„Çí„É™„Çª„ÉÉ„Éà
      googleAiAgent.resetStore();
      userInput.value = "";
      selectedStep.value = null;

      // „Éó„É¨„Éì„É•„ÉºURL„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
      if (estimatePdfUrl.value) {
        URL.revokeObjectURL(estimatePdfUrl.value);
        estimatePdfUrl.value = null;
      }
      if (innerPdfUrl.value) {
        URL.revokeObjectURL(innerPdfUrl.value);
        innerPdfUrl.value = null;
      }

      // Âá∫Âäõ„Éï„Ç°„Ç§„É´„ÅÆstate„Çí„É™„Çª„ÉÉ„Éà
      blueprintEstimateCreateProcessController.resetOutputFiles();
    } else {
      // „É¢„Éº„ÉÄ„É´„ÅåÈñã„Åã„Çå„ÅüÊôÇ„Å´Âõ≥Èù¢„Éá„Éº„Çø„ÇíÂèñÂæó
      loadBlueprintData();
    }
  }
);

// ÂâäÈô§Ê∏à„Åø - step4„Éó„É¨„Éì„É•„Éº„ÅØstate„Éô„Éº„Çπ„ÅÆÂÆüË£Ö„Å´Â§âÊõ¥

// currentStep==5„ÇíÁõ£Ë¶ñ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíËá™Âãï„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÔºã„Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„Å´Ëá™ÂãïÁßªÂãï
watch(
  () =>
    blueprintEstimateCreateProcessController
      .selectedBlueprintCostEstimationCreateJob.allProcessCompleted,
  async (allProcessCompleted) => {
    if (allProcessCompleted) {
      log("INFO", "Step5ÂÆå‰∫Ü„ÇíÊ§úÁü•„ÄÅÂá∫Âäõ„Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã„Åó„Åæ„Åô");
      await blueprintEstimateCreateProcessController.downloadOutputFiles();
      // update state
      blueprintEstimateCreateProcessController.pdfFileIsDownloaded = true;

      // üéØ Êõ∏È°ûÁîüÊàêÂÆå‰∫ÜÊôÇ„Å´Ëá™ÂãïÁöÑ„Å´„Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„Å´ÁßªÂãïÔºãstep4„ÇíÈÅ∏Êäû
      log("INFO", "Êõ∏È°ûÁîüÊàêÂÆå‰∫Ü„Å´„Çà„Çä„ÄÅ„Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„Å´Ëá™ÂãïÁßªÂãï„Åó„Åæ„Åô");
      currentActiveTab.value = "1"; // „Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„ÉñÔºàÈÖçÂàó„ÅÆ1Áï™ÁõÆÔºâ

      // step4„ÇíËá™ÂãïÈÅ∏Êäû
      const step4 = estimateSteps.value.find((step) => step.id === 4);
      if (step4) {
        selectedStep.value = step4;
        log("INFO", "Step4„ÇíËá™ÂãïÈÅ∏Êäû„Åó„Åæ„Åó„Åü");
      }

      // „É¶„Éº„Ç∂„Éº„Å´ÈÄöÁü•
      toast.add({
        title: "üéâ Ë¶ãÁ©çÊõ∏ÁîüÊàêÂÆå‰∫Ü",
        description: "„Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„ÅßË¶ãÁ©çÊõ∏„Å®ÊòéÁ¥∞Êõ∏„Çí„Éó„É¨„Éì„É•„Éº„Åß„Åç„Åæ„Åô",
        color: "success",
      });
    }
  },
  { immediate: true }
);

// Âá∫Âäõ„Éï„Ç°„Ç§„É´„ÅåÊ∫ñÂÇôÂÆå‰∫Ü„Åó„Åü„Çâ„Éó„É¨„Éì„É•„ÉºURL„ÇíÁîüÊàê
watch(
  () => [
    blueprintEstimateCreateProcessController.isEstimationFileReady,
    blueprintEstimateCreateProcessController.isPartsBreakdownFileReady,
  ],
  ([isEstimationReady, isPartsBreakdownReady]) => {
    if (isEstimationReady || isPartsBreakdownReady) {
      log("INFO", "Âá∫Âäõ„Éï„Ç°„Ç§„É´„ÅåÊ∫ñÂÇôÂÆå‰∫Ü„ÄÅ„Éó„É¨„Éì„É•„ÉºURL„ÇíÁîüÊàê„Åó„Åæ„Åô", {
        estimationReady: isEstimationReady,
        partsBreakdownReady: isPartsBreakdownReady,
      });
      createPdfPreviewUrls();
    }
  },
  { immediate: true }
);

// „Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
watch(
  () => currentActiveTab.value,
  (newTab, oldTab) => {
    log("INFO", `„Çø„Éñ„ÅåÂ§âÊõ¥„Åï„Çå„Åæ„Åó„Åü: ${oldTab} ‚Üí ${newTab}`);

    // „Ç¢„Ç¶„Éà„Éó„ÉÉ„ÉàÁ¢∫Ë™ç„Çø„Éñ„Å´ÁßªÂãï„Åó„ÅüÂ†¥Âêà
    if (newTab === "output") {
      handleOutputTabActivation();
    }
  }
);

//#region lifecycle-hooks
// blueprint store„ÅÆfetchBlueprintById„ÅßpdfPreviewUrl„ÇÇÊõ¥Êñ∞„Åï„Çå„Çã„Åü„ÇÅ„ÄÅ
// ÂÄãÂà•„ÅÆ„Éû„Ç¶„É≥„ÉàÂá¶ÁêÜ„ÅØ‰∏çË¶Å

//#endregion lifecycle-hooks
</script>

<style scoped>
/* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆöÁæ© */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out forwards;
}

/* GitHubÈ¢®Markdown„Çπ„Çø„Ç§„É´ */
.github-markdown {
  color: #24292f;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans",
    Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  word-wrap: break-words;
  overflow-wrap: anywhere;
  word-break: break-word;
  hyphens: auto;
  max-width: 100%;
}

.github-markdown h1,
.github-markdown h2,
.github-markdown h3,
.github-markdown h4,
.github-markdown h5,
.github-markdown h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25;
  color: #1f2328;
}

.github-markdown h1 {
  font-size: 2em;
  border-bottom: 1px solid #d0d7de;
  padding-bottom: 0.3em;
}

.github-markdown h2 {
  font-size: 1.5em;
  border-bottom: 1px solid #d0d7de;
  padding-bottom: 0.3em;
}

.github-markdown h3 {
  font-size: 1.25em;
  border-bottom: 1px solid #d0d7de;
  padding-bottom: 0.3em;
}

.github-markdown h4 {
  font-size: 1em;
  border-bottom: 1px solid #d0d7de;
  padding-bottom: 0.3em;
}

.github-markdown h5 {
  font-size: 0.875em;
  border-bottom: 1px solid #d0d7de;
  padding-bottom: 0.3em;
}

.github-markdown h6 {
  font-size: 0.85em;
  color: #656d76;
}

.github-markdown p {
  margin-top: 0;
  margin-bottom: 16px;
}

.github-markdown blockquote {
  margin: 0;
  padding: 0 1em;
  color: #656d76;
  border-left: 0.25em solid #d0d7de;
  margin-bottom: 16px;
}

.github-markdown ul,
.github-markdown ol {
  margin-top: 0;
  margin-bottom: 16px;
  padding-left: 2em;
}

.github-markdown li {
  margin-bottom: 0.25em;
}

.github-markdown li > p {
  margin-bottom: 0;
  margin-top: 16px;
}

.github-markdown li + li {
  margin-top: 0.25em;
}

.github-markdown code {
  padding: 0.2em 0.4em;
  margin: 0;
  font-size: 85%;
  white-space: break-spaces;
  background-color: rgba(175, 184, 193, 0.2);
  border-radius: 6px;
  font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas,
    "Liberation Mono", Menlo, monospace;
}

.github-markdown pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f6f8fa;
  border-radius: 6px;
  margin-bottom: 16px;
  border: 1px solid #d0d7de;
}

.github-markdown pre code {
  display: inline;
  max-width: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.github-markdown table {
  border-spacing: 0;
  border-collapse: collapse;
  display: block;
  width: max-content;
  max-width: 100%;
  overflow: auto;
  margin-bottom: 16px;
}

.github-markdown table th,
.github-markdown table td {
  padding: 6px 13px;
  border: 1px solid #d0d7de;
}

.github-markdown table th {
  font-weight: 600;
  background-color: #f6f8fa;
}

.github-markdown table tr {
  background-color: #ffffff;
  border-top: 1px solid #c6cbd1;
}

.github-markdown table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

.github-markdown a {
  color: #0969da;
  text-decoration: none;
}

.github-markdown a:hover {
  text-decoration: underline;
}

.github-markdown strong {
  font-weight: 600;
}

.github-markdown em {
  font-style: italic;
}

.github-markdown hr {
  height: 0.25em;
  padding: 0;
  margin: 24px 0;
  background-color: #d0d7de;
  border: 0;
}

/* „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏ÔºàÈùí„ÅÑ„Éê„Éñ„É´ÔºâÂÜÖ„ÅÆMarkdown„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
.bg-gradient-to-br.from-blue-500 .github-markdown,
.bg-gradient-to-br.from-blue-500 .github-markdown h1,
.bg-gradient-to-br.from-blue-500 .github-markdown h2,
.bg-gradient-to-br.from-blue-500 .github-markdown h3,
.bg-gradient-to-br.from-blue-500 .github-markdown h4,
.bg-gradient-to-br.from-blue-500 .github-markdown h5,
.bg-gradient-to-br.from-blue-500 .github-markdown h6 {
  color: #ffffff !important;
}

.bg-gradient-to-br.from-blue-500 .github-markdown h1,
.bg-gradient-to-br.from-blue-500 .github-markdown h2 {
  border-bottom-color: rgba(255, 255, 255, 0.3);
}

.bg-gradient-to-br.from-blue-500 .github-markdown h3 {
  border-bottom-color: rgba(255, 255, 255, 0.3);
}

.bg-gradient-to-br.from-blue-500 .github-markdown h4 {
  border-bottom-color: rgba(255, 255, 255, 0.3);
}

.bg-gradient-to-br.from-blue-500 .github-markdown h5 {
  border-bottom-color: rgba(255, 255, 255, 0.3);
}

.bg-gradient-to-br.from-blue-500 .github-markdown blockquote {
  color: rgba(255, 255, 255, 0.8);
  border-left-color: rgba(255, 255, 255, 0.3);
}

.bg-gradient-to-br.from-blue-500 .github-markdown code {
  background-color: rgba(255, 255, 255, 0.2);
  color: #ffffff;
}

.bg-gradient-to-br.from-blue-500 .github-markdown pre {
  background-color: rgba(0, 0, 0, 0.2);
  border-color: rgba(255, 255, 255, 0.3);
}

.bg-gradient-to-br.from-blue-500 .github-markdown a {
  color: #87ceeb;
}

.bg-gradient-to-br.from-blue-500 .github-markdown hr {
  background-color: rgba(255, 255, 255, 0.3);
}

/* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÅÆ„Çπ„Çø„Ç§„É™„É≥„Ç∞ - „Çà„ÇäÊ¥óÁ∑¥„Åï„Çå„Åü„Éá„Ç∂„Ç§„É≥ */
.overflow-y-auto::-webkit-scrollbar {
  width: 6px;
}

.overflow-y-auto::-webkit-scrollbar-track {
  background: transparent;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #cbd5e1, #94a3b8);
  border-radius: 10px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(to bottom, #94a3b8, #64748b);
}

/* „Éõ„Éê„Éº„Ç®„Éï„Çß„ÇØ„Éà„ÅÆÊîπËâØ */
.group:hover .group-hover\:opacity-100 {
  opacity: 1;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
@media (max-width: 768px) {
  .max-w-\[75\%\] {
    max-width: 85%;
  }

  .github-markdown {
    font-size: 13px;
  }

  .github-markdown h1 {
    font-size: 1.6em;
  }

  .github-markdown h2 {
    font-size: 1.3em;
  }

  .github-markdown pre {
    padding: 12px;
    font-size: 80%;
  }
}

/* „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ËÉåÊôØ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
.bg-gradient-to-br {
  background-size: 200% 200%;
  animation: gradient-shift 3s ease infinite;
}

@keyframes gradient-shift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}
</style>
